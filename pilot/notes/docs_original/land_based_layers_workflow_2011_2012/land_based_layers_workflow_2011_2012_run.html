<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title>land_based_layers_workflow_2011_2012_run</title>
<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>
</head>
<body>
<h1 id="toc_0">Land-Based Layers Workflow - 2011-2012 run</h1>

<h3 id="toc_1">Path on Neptune:</h3>

<p>Run 2011-2012:
<code>/var/cache/halpern-et-al/mnt/storage/marine_threats/impact_layers_2013_redo/impact_layers/work/land_based/201112/</code>
Script only location on Neptune:
<code>/var/cache/halpern-et-al/mnt/storage/marine_threats/impact_layers_2013_redo/impact_layers/work/land_based/201112_script_only/</code></p>

<h3 id="toc_2">Note:</h3>

<ul>
<li>The unix steps were ran on Neptune (Ubuntu 12.04.5 LTS)</li>
<li>On Neprtune, a local install of Python was used; Here is the info to install one if necessary: <a href="https://help.nceas.ucsb.edu/local_install_python_on_a_server">https://help.nceas.ucsb.edu/local_install_python_on_a_server</a></li>
<li>The Windows/ArcGIS ran on Bumblebee in NCEAS Vizlab (Win 7 with ArcGIS 10.2)</li>
<li>Begin by copying the <em>201112_script_only</em> directory and go step by step</li>
</ul>

<h2 id="toc_3">Step 1: FAO</h2>

<p><em>Download and format FAO pesticide/fertilizer data.</em></p>

<h3 id="toc_4">Get raw FAO fertilizer data</h3>

<ul>
<li>go to: <del><a href="http://faostat.fao.org">http://faostat.fao.org</a></del> New website: <a href="http://faostat3.fao.org/download/R/RF/E">http://faostat3.fao.org/download/R/RF/E</a></li>
<li><p>select data options:</p>

<pre><code>- country:              Click *Regions* tab and select: *World &gt; (List)*
- year:                 select all (2002-2012)
- item:                 select all 3 &quot;total nutrients&quot; items
- element:              [Consumption in nutrients]
- selected parameters:  click show</code></pre></li>
<li><p>click download (csv format)</p></li>
</ul>

<h3 id="toc_5">Get raw FAO pesticide data</h3>

<ul>
<li>go to: <del><a href="http://faostat.fao.org">http://faostat.fao.org</a></del> New website: <a href="http://faostat3.fao.org/download/R/RP/E">http://faostat3.fao.org/download/R/RP/E</a></li>
<li><p>select data options:</p>

<pre><code>- country:              Click *Regions* tab and select: *World &gt; (List)*
- year:                 select all (1990-2013)
- item:                 select all the &quot;+ (Total)&quot; items
- element:              [Use]
- selected parameters:  click show</code></pre></li>
<li><p>click download (csv format)</p>

<h4 id="toc_6"><em>=&gt; CHANGES in data with new FAO website: They have remove the country id from the dataset and automatically removed the countries with no data</em></h4></li>
</ul>

<h3 id="toc_7">Get FAO country codes table</h3>

<ul>
<li>go to: <del><a href="http://www.fao.org/countryprofiles/modulemaker/en/">http://www.fao.org/countryprofiles/modulemaker/en/</a></del> </li>
<li>New website: <a href="http://www.fao.org/countryprofiles/geoinfo/modulemaker/index.html">http://www.fao.org/countryprofiles/geoinfo/modulemaker/index.html</a> to get the xml file with counrty codes: Self-governing territories.xml</li>
<li>go to:<a href="http://faostat.fao.org/site/371/DesktopDefault.aspx?PageID=371">http://faostat.fao.org/site/371/DesktopDefault.aspx?PageID=371</a></li>
<li>download &quot;the area list&quot;, xls format to get the country codes</li>
<li>Open in in Excel and save it as <em>country_codes_fao.csv</em></li>
</ul>

<h3 id="toc_8">Get World Bank AG % of GDP table data</h3>

<ul>
<li>go to: <a href="http://data.worldbank.org/indicator">http://data.worldbank.org/indicator</a></li>
<li>click on &quot;Agriculture, value added (% of GDP)&quot;</li>
<li>this should take you to: <a href="http://data.worldbank.org/indicator/NV.AGR.TOTL.ZS/countries">http://data.worldbank.org/indicator/NV.AGR.TOTL.ZS/countries</a></li>
<li>click &#39;Download Data-&gt;XML&#39;</li>
</ul>

<h3 id="toc_9">Get World Bank GDP table data</h3>

<ul>
<li>go to: <a href="http://data.worldbank.org/indicator">http://data.worldbank.org/indicator</a></li>
<li>click on &quot;GDP (current US$)&quot;</li>
<li>this should take you to: <a href="http://data.worldbank.org/indicator/NY.GDP.MKTP.CD/countries">http://data.worldbank.org/indicator/NY.GDP.MKTP.CD/countries</a></li>
<li>click &#39;Download Data-&gt;XML&#39;</li>
</ul>

<h3 id="toc_10">Run scripts</h3>

<ul>
<li><p>change worldbank xml files to csv file for next step:</p>

<pre><code>./worldbank_gdp_parse.py</code></pre></li>
<li><p>create table of fertilizer/pesticide consumption in tonnes per country code
(run twice with different year ranges; e.g. 2007-2010 and 2011-2010):</p>

<pre><code>R --vanilla &lt;fao_update.R</code></pre></li>
<li><p>add the country code to the FAO data: </p>

<pre><code>R --vanilla &lt;add_country_codes.R</code></pre></li>
<li><p>compare/plot results from previous step
(run with correct input files from previous step):</p>

<pre><code>R --vanilla &lt;fao_compare_temporal.R</code></pre></li>
<li><p>the <code>fao_compare_2008.R</code> script was used to compare the new methodology to the one used in the original Halpern 2008 paper</p></li>
</ul>

<h3 id="toc_11">Notes</h3>

<ul>
<li>Details behind FAO fertilizer methodology can be found here (note that there was a change in the methodology after 2002):<br>
<a href="http://www.fao.org/fileadmin/templates/ess/ess_test_folder/Publications/Agrienvironmental/Methodologocal_Notes_FAOSTAT2011.pdf">http://www.fao.org/fileadmin/templates/ess/ess_test_folder/Publications/Agrienvironmental/Methodologocal_Notes_FAOSTAT2011.pdf</a></li>
<li>Also note the distinction between consumption by nutrients and consumption by weight for the fertilizer data.  We have used consumption by nutrients for the final analysis, but also tried consumption by weight (see <code>fert_by_weight</code> folder for plots).</li>
</ul>

<hr>

<h2 id="toc_12">Step 2: Landcover/Landuse (LCLU)</h2>

<p><em>Download and format LCLU data.</em></p>

<h3 id="toc_13">Dataset background</h3>

<ul>
<li>desired dataset:  MCD12Q1 V051: land cover type 1 (IGBP)</li>
<li>relevant links:

<ul>
<li><a href="http://www.bu.edu/lcsc/data-documentation/">http://www.bu.edu/lcsc/data-documentation/</a></li>
<li><a href="http://earthobservatory.nasa.gov/Newsroom/view.php?id=22585">http://earthobservatory.nasa.gov/Newsroom/view.php?id=22585</a></li>
<li><a href="https://lpdaac.usgs.gov/products/modis_products_table/mcd12q1">https://lpdaac.usgs.gov/products/modis_products_table/mcd12q1</a></li>
</ul></li>
</ul>

<h3 id="toc_14">Download dataset</h3>

<ul>
<li>go to: <a href="http://reverb.echo.nasa.gov/reverb/">http://reverb.echo.nasa.gov/reverb/</a></li>
<li><p>follow these steps:</p>

<pre><code>- Search Terms: mcd12q1
- Temporal Search:  
  start:  2012-01-01 00:00:00
  end:    2012-12-31 23:59:59
- [press enter]
- Select Datasets: MCD12Q1 version 51
- [Press: Search for Granules]
- [Press: Accept]
- [Press: All Shopping Cart button]
- [Press: View Items in Cart]
- [Press: Download]
- Select URLs to Download:  Data
- Select Download Option:  Text File
- Press:  Save
- [Press: Download]
- Select URLs to Download:  Metadata
- Select Download Option:  Text File
- Press:  Save</code></pre></li>
</ul>

<h3 id="toc_15">Run scripts</h3>

<ul>
<li><p>download hdf files:</p>

<pre><code>./go_download_files.sh</code></pre></li>
<li><p>merge hdfs into single tif with igbp landcover classes, for both years:</p>

<pre><code>./hdf_to_tif.sh</code></pre></li>
</ul>

<h3 id="toc_16">Notes</h3>

<ul>
<li>We also tried to use the UMD classification (see <code>global_landcover/umd</code>), but used the IGBP classification for the final analysis.</li>
<li><p>Some classification statistics (number of 500 m^2 pixels):</p>

<pre><code>umd classification:
  landclass 12 (cropland),  2005:              76716687
  landclass 12 (cropland),  2009:              76463693
  landclass 13 (urban),     2005:              3063063
  landclass 13 (urban),     2009:              3062706

igbp classification:
  landclass 12 (cropland),  2005:              56632531
  landclass 12 (cropland),  2009:              56090829
  landclass 14 (cropland/natural veg),  2005:  42801682
  landclass 14 (cropland/natural veg),  2009:  41760296
  landclass 13 (urban),     2005:              3058152
  landclass 13 (urban),     2009:              3056223</code></pre></li>
</ul>

<hr>

<h2 id="toc_17">Step 3: Dasym Prepare</h2>

<p><em>Prepare data for dasymetric mapping.  This step splits global landcover rasters by continents.</em>
<em>This step needs to be run on a Windows machine with ArcGIS installed</em></p>

<ul>
<li><p>run continent/countries raster prep script:</p>

<pre><code>C:\Python27\ArcGIS10.1\python.exe
  landcover_countries_continents_split.py</code></pre></li>
<li><p>(<em>Note</em>: when re-running above script, use fresh/original shp file for countries_units.shp in case .prj disappears during last run)</p></li>
</ul>

<hr>

<h2 id="toc_18">Step 4: Dasym</h2>

<p><em>Run dasymetric mapping.</em></p>

<h3 id="toc_19">Run scripts</h3>

<ul>
<li>use <code>run_dasym_loop_*.sh</code> to run <code>dasym_map.py</code> multiple times for each
continent, year, pest/fert combination</li>
</ul>

<h3 id="toc_20">Notes</h3>

<ul>
<li>run the sripts at the same time as this step is time consuming</li>
<li>relevant links:<br>
<a href="http://portal.nceas.ucsb.edu/Members/perry/methods/dasymetric-mapping/">http://portal.nceas.ucsb.edu/Members/perry/methods/dasymetric-mapping/</a><br>
<a href="http://portal.nceas.ucsb.edu/Members/perry/methods/dasymetric_flowchart2.png/image_view_fullscreen">http://portal.nceas.ucsb.edu/Members/perry/methods/dasymetric_flowchart2.png/image_view_fullscreen</a><br>
<a href="https://github.com/scw/global-threats-model/tree/master/Dasymetric">https://github.com/scw/global-threats-model/tree/master/Dasymetric</a></li>
</ul>

<hr>

<h2 id="toc_21">Step 5: Zonal Stats</h2>

<p><em>Calculate zonal statistics for each continent -- sums of fertilizer/pesticide values for each basin.</em></p>

<ul>
<li><p>run zonal stats script:</p>

<pre><code>C:\Python27\ArcGIS10.1\python.exe terra_stats_fert.py
C:\Python27\ArcGIS10.1\python.exe terra_stats_pest.py</code></pre></li>
<li><p><del>(<em>Note</em>: you&#39;ll need to create blank af, as, etc dirs first in [5]_zonal_stats\output)</del> Added this to the script</p></li>
</ul>

<hr>

<h2 id="toc_22">Step 6: Global Plume Prepare</h2>

<p><em>Prepare global plume data.  This step updates global plume shapefile fertilizer/pesticide sum values to the new basin zonal statistics.</em></p>

<ul>
<li>first, create blank <code>global_plume*.shp</code> files by resetting the DBF fields to zero via <code>zero_dbf.py</code> (resulting shapefiles can be found in <code>output/og_blank</code>)</li>
<li>run <code>update_global_plume.py</code> twice, with different years</li>
<li>run <code>clean_global_plume.py</code> twice for both time periods to remove zero fert/pest values<br>
(note: this script will not update FIDs)</li>
<li>run <code>splitter.sh</code> to slice the pour points shapefile into 4 parts
******</li>
</ul>

<h2 id="toc_23">Step 7: Plume Model</h2>

<p><em>Run global plume model.</em></p>

<ul>
<li><p>run <code>plume_distributions.R</code> script (will need to install maptools package in R: install.packages(&#39;maptools&#39;)). Use the &quot;0.05%&quot; values in log output to manually update <code>plume_buffer.py</code> limits values for pesticides and fertilizer.</p>

<pre><code>$ R --vanilla &lt; plume_distributions.R</code></pre></li>
</ul>

<h3 id="toc_24">Note:</h3>

<p>This next step relies on <em>grass</em>, you can find the grass setup I used here:
<code>/var/cache/halpern-et-al/mnt/storage/marine_threats/grass_jb</code></p>

<p>To define the location extent, I used the extent of the ocean_mask file.</p>

<p>The mapset projection was set using the projection of global<em>plume</em>*.shp</p>

<ul>
<li>launch grass64</li>
<li>select a the PERMANENT mapset</li>
<li><p>add the ocean mask to the PERMANENT mapset: <code>r.in.gdal -o input=&quot;impact_layers_redo/land_based/201112/step0/ocean_mask/ocean_mask.tif&quot; output=ocean</code></p>

<p><strong>Note</strong>: This need only to be done once</p></li>
<li><p>run: <code>./run_2011_2012.sh</code></p>

<p><strong>Note</strong>: you need to uncomment the part you would like to run and change the year period accordingly to your global_plume<em>*.shp
<strong>tip</strong>: run 8 mapsets simultaneously during plume</em>buffer.py for efficiency</p></li>
<li><p>When all the plume runs are done combine plumes into single global raster:</p>

<pre><code>./gdal_add.py -o global_plumes_pest_2011_2012_raw.tif -ot Float32 plume_pest*.tif
./gdal_add.py -o global_plumes_fert_2011_2012_raw.tif -ot Float32 plume_fert*.tif
# note: may need to add plumes in stages</code></pre></li>
<li><p>repeat above steps for other time period</p></li>
</ul>

<hr>

<h2 id="toc_25">Step 8: Plume Finalize</h2>

<p><em>Produce final products.</em> </p>

<ul>
<li>run <code>difference_rasters.py</code> to create change detection rasters</li>
<li>run <code>log_normalize_rasters.py</code> to log-normalize yearly and difference plume rasters</li>
<li>run <code>plume_plots.m</code> in matlab to produce histogram figures of final rasters</li>
</ul>

<hr>

<p>Adapted from John Potapenko (john@scigeo.org)&#39;s version (<code>/var/cache/halpern-et-al/mnt/storage/marine_threats/impact_layers_2013_redo/impact_layers/work/land_based/documentation/land_based_layers_workflow</code>) by Julien Brun (brun@nceas.ucsb.edu)</p>


</body>

</html>
